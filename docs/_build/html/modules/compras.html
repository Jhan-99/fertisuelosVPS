

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>compras &mdash; CostosBocadillo 1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="CostosBocadillo 1.0 documentation" href="../index.html"/>
        <link rel="next" title="conversion_unidades" href="conversionunid.html"/>
        <link rel="prev" title="CentroCostos" href="centrocostos.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> CostosBocadillo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Instalación</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuracion.html">Configuración</a></li>
<li class="toctree-l1"><a class="reference internal" href="all-about-me.html">Todo sobre el Proyecto</a></li>
</ul>
<p class="caption"><span class="caption-text">Apps:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="baches.html">baches</a></li>
<li class="toctree-l1"><a class="reference internal" href="centrocostos.html">CentroCostos</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">compras</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#migrations">Migrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#models">Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="#admin">Admin</a></li>
<li class="toctree-l2"><a class="reference internal" href="#forms">Forms</a></li>
<li class="toctree-l2"><a class="reference internal" href="#views">Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="#urls">Urls</a></li>
<li class="toctree-l2"><a class="reference internal" href="#apps">Apps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="conversionunid.html">conversion_unidades</a></li>
<li class="toctree-l1"><a class="reference internal" href="empleados.html">empleados</a></li>
<li class="toctree-l1"><a class="reference internal" href="fabricas.html">fabricas</a></li>
<li class="toctree-l1"><a class="reference internal" href="insumos.html">insumos</a></li>
<li class="toctree-l1"><a class="reference internal" href="manoobra.html">ManoObra</a></li>
<li class="toctree-l1"><a class="reference internal" href="moempaques.html">MOempaques</a></li>
<li class="toctree-l1"><a class="reference internal" href="productos.html">productos</a></li>
<li class="toctree-l1"><a class="reference internal" href="propietarios.html">Propietarios</a></li>
<li class="toctree-l1"><a class="reference internal" href="usuarios.html">usuario</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">CostosBocadillo</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>compras</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/modules/compras.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="figure align-left">
<img alt="../_images/carpeta.png" src="../_images/carpeta.png" />
</div>
<div class="section" id="compras">
<h1>compras<a class="headerlink" href="#compras" title="Permalink to this headline">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Descripción</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CostosBaocadillo
└── apps
       └── compras
           ├── __init__.py
           ├── admin.py
           ├── apps.py
           ├── migrations
           │   └── __init__.py
           ├── models.py
           ├── tests.py
           ├── views.py
           ├── forms.py
           └── urls.py
</pre></div>
</div>
<div class="figure align-left">
<img alt="../_images/carpeta.png" src="../_images/carpeta.png" />
</div>
<div class="section" id="migrations">
<h2>Migrations<a class="headerlink" href="#migrations" title="Permalink to this headline">¶</a></h2>
<p><em>Carpeta</em> : <code class="xref py py-mod docutils literal notranslate"><span class="pre">migrations</span></code></p>
<blockquote>
<div><p>Este es el directorio donde se almacenan todas las migraciones con las respectivas dependencias de sus modelos. Dentro de este archivo se encuentran los campos de la base de datos que establecimos en el archivo <code class="docutils literal notranslate"><span class="pre">models.py</span></code> con la respectiva característica del campo. Este archivo es generado con el comando <code class="docutils literal notranslate"><span class="pre">makemigrations</span></code> de Django y genera nuevas versiones con cada migración creada.</p>
</div></blockquote>
<div class="figure align-left">
<img alt="../_images/py.png" src="../_images/py.png" />
</div>
</div>
<div class="section" id="models">
<h2>Models<a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h2>
<p><em>Archivo</em> : <code class="docutils literal notranslate"><span class="pre">models.py</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Un modelo en Django es una clase importada de la biblioteca django.db que actúa como puente entre su base de datos y el servidor. Esta clase es una representación de la estructura de datos utilizada por su sitio web. Relacionará directamente esta estructura de datos con la base de datos. Para que no tenga que aprender SQL para la base de datos.</p>
</div>
<ol class="arabic">
<li><p>En primer lugar, se creo una nueva aplicación con el comando:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">django</span><span class="o">-</span><span class="n">admin</span> <span class="n">startapp</span> <span class="n">compras</span>
</pre></div>
</div>
</li>
</ol>
<p>donde <code class="docutils literal notranslate"><span class="pre">compras</span></code> es el nombre de la aplicación.</p>
<ol class="arabic simple" start="2">
<li><p>Después de crear la aplicación, debe instalarse en el proyecto. Para ello, se agregó la aplicación <code class="docutils literal notranslate"><span class="pre">compras</span></code> a la lista <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> en el archivo <em>settings.py</em>.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
<span class="hll">    <span class="s1">&#39;apps.compras&#39;</span><span class="p">,</span>
</span>    <span class="p">]</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>En el archivo <em>models.py</em> encontraremos el siguiente código, correspondiente al modelo de <code class="docutils literal notranslate"><span class="pre">Compras</span></code>.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">apps.insumos.models</span> <span class="kn">import</span> <span class="n">Insumos</span>
<span class="kn">from</span> <span class="nn">apps.insumos.models</span> <span class="kn">import</span> <span class="n">InsumosGenericos</span>
<span class="kn">from</span> <span class="nn">apps.Propietarios.models</span> <span class="kn">import</span> <span class="n">Propietarios</span>
<span class="kn">from</span> <span class="nn">apps.fabricas.models</span> <span class="kn">import</span> <span class="n">Fabricas</span>
<span class="kn">from</span> <span class="nn">apps.baches.models</span> <span class="kn">import</span> <span class="n">Baches</span>
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Compras</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">id_compra</span> <span class="o">=</span>    <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="c1">#propietario refiere a id_pro _ al migrar cambia a propietario_id</span>
    <span class="n">propietario</span> <span class="o">=</span>  <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Propietarios</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">fabrica</span> <span class="o">=</span>      <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Fabricas</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">fecha_compra</span> <span class="o">=</span>    <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="s1">&#39;Fecha compra&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s1">&#39;compras&#39;</span>

<span class="k">class</span> <span class="nc">Insumos_Compras</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">id_ico</span> <span class="o">=</span>      <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="c1">#insumo refiere a id_insumo _ al migrar cambia a insumo_id</span>
    <span class="n">insumo</span> <span class="o">=</span>     <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Insumos</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">compra</span> <span class="o">=</span>     <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Compras</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">cantidad</span> <span class="o">=</span>   <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">precio</span> <span class="o">=</span>     <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>
    <span class="n">precio_und_min_ico</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>
    <span class="n">und_min_ico</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s1">&#39;Und Min&#39;</span><span class="p">,</span> <span class="n">max_length</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s1">&#39;insumos_compras&#39;</span>


<span class="k">class</span> <span class="nc">BacheInsumo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">id_bai</span> <span class="o">=</span>                 <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">id_ico_bai</span> <span class="o">=</span>             <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Insumos_Compras</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="c1">#el id del insumo generrico compra</span>
    <span class="n">id_ige_bai</span> <span class="o">=</span>             <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">InsumosGenericos</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="c1">#es el id del bache</span>
    <span class="n">id_bpr_bai</span> <span class="o">=</span>             <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Baches</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">valor_prom_unidad_bai</span> <span class="o">=</span>  <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>
    <span class="c1">#se refiere a gr o ml según la unidad  mínima</span>
    <span class="n">unidad_medida_bai</span> <span class="o">=</span>      <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s1">&#39;Unidad medida bache insumo&#39;</span><span class="p">,</span> <span class="n">max_length</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">valor_total_bai</span> <span class="o">=</span>        <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s1">&#39;bache_insumo&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;BI&#39;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s1">&#39;BacheInsumos&#39;</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id_bai&#39;</span><span class="p">]</span>
</pre></div>
</div>
<ol class="arabic" start="4">
<li><p>Aquí podemos ver que los campos de los modelos tienen muchos métodos para la entrada web, como <code class="xref py py-func docutils literal notranslate"><span class="pre">CharField()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">IntegerField()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">AutoField()</span></code>. Podemos ver mas <a class="reference external" href="https://docs.djangoproject.com/en/3.0/ref/models/fields/">referencias</a> en la documentación de Django.</p></li>
<li><p>Ahora ejecutaremos los comandos:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">py</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">makemigrations</span>
<span class="o">&gt;</span> <span class="n">py</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">migrate</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Asegúrese de tener la base de datos conectada y de haber iniciado el servidor Apache y el servidor MySQL en la base de datos.</p>
</div>
<div class="figure align-left">
<img alt="../_images/py.png" src="../_images/py.png" />
</div>
</div>
<div class="section" id="admin">
<h2>Admin<a class="headerlink" href="#admin" title="Permalink to this headline">¶</a></h2>
<p><em>Archivo</em> : <code class="docutils literal notranslate"><span class="pre">admin.py</span></code></p>
<p>Al registrar el  módelo <code class="docutils literal notranslate"><span class="pre">Empleados</span></code> con <code class="docutils literal notranslate"><span class="pre">admin.site.register()</span></code>, Django puede construir una representación del formulario predeterminado.
Para poder registrar un modelo en el archivo <code class="xref py py-mod docutils literal notranslate"><span class="pre">models.py</span></code> debemos importar el modelo con la función <code class="docutils literal notranslate"><span class="pre">from</span></code> y registrar el modelo con la sentencia <code class="docutils literal notranslate"><span class="pre">admin.site.register()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Compras</span>       <span class="c1"># Importar el modelo desde models.py</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Compras</span><span class="p">)</span>       <span class="c1"># (nombre del modelo creado en models.py)</span>
</pre></div>
</div>
<div class="figure align-left">
<img alt="../_images/py.png" src="../_images/py.png" />
</div>
</div>
<div class="section" id="forms">
<h2>Forms<a class="headerlink" href="#forms" title="Permalink to this headline">¶</a></h2>
<p><em>Archivo</em> : <code class="docutils literal notranslate"><span class="pre">forms.py</span></code></p>
<p>En este archivo podremos crear los imputs para los campos de los formularios creados en html.</p>
<p>Lo bueno de los formularios de Django es que podemos definirlos desde cero o crear un <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code>, el cual guardará el resultado del formulario en el modelo. Para esto crearemos un formulario para nuestros modelos <em>Compras</em> y <em>Insumos_Compras</em>.</p>
<p>Los formularios tienen su propio archivo: <code class="docutils literal notranslate"><span class="pre">forms.py</span></code>.  Dentro de este archivo encontraremos el siguiente código:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Compras</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Insumos_Compras</span>
<span class="k">class</span> <span class="nc">ComprasForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Compras</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;propietario&#39;</span><span class="p">,</span> <span class="s1">&#39;fabrica&#39;</span><span class="p">,</span> <span class="s1">&#39;fecha_compra&#39;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">Insumos_ComprasForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Insumos_Compras</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;insumo&#39;</span><span class="p">,</span> <span class="s1">&#39;compra&#39;</span><span class="p">,</span> <span class="s1">&#39;cantidad&#39;</span><span class="p">,</span> <span class="s1">&#39;precio&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Lo primero, necesitamos importar Django forms <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">django</span> <span class="pre">import</span> <span class="pre">forms</span></code> y nuestros modelos <em>Compras</em> y <em>Insumos_Compras</em> <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">.models</span> <span class="pre">import</span> <span class="pre">..</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">ComprasForm</span></code> y <code class="docutils literal notranslate"><span class="pre">Insumos_ComprasForm</span></code>, son los nombres de nuestros formularios. Necesitamos decirle a Django que este formulario es un <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> así Django hará algo el resto por nosotros - <code class="docutils literal notranslate"><span class="pre">forms.ComprasForm</span></code> es responsable de ello.</p>
<p>Luego, tenemos <code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">Meta</span></code>, donde le decimos a Django qué modelo debe ser utilizado para crear este formulario <code class="docutils literal notranslate"><span class="pre">model</span> <span class="pre">=</span> <span class="pre">Compras</span> <span class="pre">|</span> <span class="pre">Insumos_ComprasForm</span></code>.</p>
<div class="figure align-left">
<img alt="../_images/py.png" src="../_images/py.png" />
</div>
</div>
<div class="section" id="views">
<h2>Views<a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h2>
<p><em>Archivo</em> : <code class="docutils literal notranslate"><span class="pre">views.py</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Empleados</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="admonition-importaciones admonition">
<p class="admonition-title">Importaciones</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">JsonResponse</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span>
<span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">import</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">apps.insumos.models</span> <span class="kn">import</span> <span class="n">Insumos</span>
<span class="kn">from</span> <span class="nn">apps.Propietarios.models</span> <span class="kn">import</span> <span class="n">Propietarios</span>
<span class="kn">from</span> <span class="nn">apps.fabricas.models</span> <span class="kn">import</span> <span class="n">Fabricas</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Compras</span><span class="p">,</span> <span class="n">Insumos_Compras</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</pre></div>
</div>
</div>
<div class="admonition-getcompras admonition">
<p class="admonition-title">GetCompras</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">GetCompras</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">search_type</span>  <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;search_type&#39;</span><span class="p">)</span>
        <span class="n">from_date</span>  <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;from_date&#39;</span><span class="p">)</span>
        <span class="n">to_date</span>  <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;to_date&#39;</span><span class="p">)</span>
        <span class="n">filtro_cp_mes</span>  <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filtro_cp_mes&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">aplicar</span><span class="p">():</span>
            <span class="n">repetido</span><span class="p">,</span> <span class="n">unico_id</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">compras</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">id_ins</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unico_id</span><span class="p">:</span>
                    <span class="n">unico_id</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">id_ins</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">id_ins</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">repetido</span><span class="p">:</span>
                        <span class="n">repetido</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">id_ins</span><span class="p">)</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;unico_id &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">unico_id</span><span class="p">))</span>
            <span class="n">insumos</span> <span class="o">=</span> <span class="n">Insumos</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id_ins__in</span>  <span class="o">=</span> <span class="n">unico_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;compras/filtros.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;compras&#39;</span><span class="p">:</span> <span class="n">compras</span><span class="p">,</span> <span class="s1">&#39;insumos&#39;</span><span class="p">:</span> <span class="n">insumos</span><span class="p">})</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">search_type</span> <span class="o">==</span> <span class="s1">&#39;by_month&#39;</span><span class="p">:</span>
            <span class="c1">#return HttpResponse(&quot;xmes&quot;)</span>
            <span class="n">compras</span> <span class="o">=</span> <span class="n">Compras</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">raw</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM  compras c  INNER JOIN insumos_compras ic  ON  ic.compra_id = c.id_compra INNER JOIN fabricas       f ON c.fabrica_id = f.id_fab INNER JOIN propietarios p ON p.id_pro = c.propietario_id INNER JOIN insumos ins ON ins.id_ins = ic.insumo_id       WHERE EXTRACT(month FROM fecha_compra) = </span><span class="si">%s</span><span class="s1"> AND p.user_id = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">filtro_cp_mes</span><span class="p">,</span> <span class="n">user_id</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">aplicar</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">search_type</span> <span class="o">==</span> <span class="s1">&#39;by_range&#39;</span><span class="p">:</span>
            <span class="c1">#return HttpResponse(&quot;xrango&quot;)</span>
            <span class="n">compras</span> <span class="o">=</span> <span class="n">Compras</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">raw</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM  compras c  INNER JOIN insumos_compras ic  ON  ic.compra_id = c.id_compra INNER JOIN fabricas       f ON c.fabrica_id = f.id_fab INNER JOIN propietarios p ON p.id_pro = c.propietario_id INNER JOIN insumos ins ON ins.id_ins = ic.insumo_id       WHERE c.fecha_compra  BETWEEN  </span><span class="si">%s</span><span class="s1"> AND </span><span class="si">%s</span><span class="s1"> AND p.user_id = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,[</span><span class="n">from_date</span><span class="p">,</span> <span class="n">to_date</span><span class="p">,</span> <span class="n">user_id</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">aplicar</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;No hay criterios de busqueda&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">compras</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">id_compra</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition-crear-empleados admonition">
<p class="admonition-title">Crear Empleados</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">GetInsID</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
        <span class="n">id_insumo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id_insumo&quot;</span><span class="p">)</span>
        <span class="n">insumos</span> <span class="o">=</span> <span class="n">Insumos</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id_ins</span> <span class="o">=</span> <span class="n">id_insumo</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ins</span> <span class="ow">in</span> <span class="n">insumos</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">id_ins</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition-crear-compra admonition">
<p class="admonition-title">Crear Compra</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">CrearCompra</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">action</span>  <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;add_in_editar&#39;</span><span class="p">)</span>
        <span class="n">id_compra</span>  <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;referencia&#39;</span><span class="p">)</span>
        <span class="n">fabrica_id</span>  <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fabrica_id&#39;</span><span class="p">)</span>
        <span class="n">propietario_id</span>  <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;propietario_id&#39;</span><span class="p">)</span>
        <span class="n">fecha_compra</span>  <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fecha_compra&#39;</span><span class="p">)</span>
        <span class="n">compra</span> <span class="o">=</span> <span class="n">Compras</span><span class="p">(</span><span class="n">id_compra</span> <span class="o">=</span> <span class="n">id_compra</span><span class="p">,</span> <span class="n">fabrica_id</span> <span class="o">=</span> <span class="n">fabrica_id</span><span class="p">,</span> <span class="n">propietario_id</span> <span class="o">=</span> <span class="n">propietario_id</span><span class="p">,</span> <span class="n">fecha_compra</span> <span class="o">=</span> <span class="n">fecha_compra</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;edi&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&gt; edit&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">compra</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">insumo_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;insumo_id[]&#39;</span><span class="p">)</span>
        <span class="n">cantidad</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;cantidad[]&#39;</span><span class="p">)</span>
        <span class="n">precio</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;precio[]&#39;</span><span class="p">)</span>

        <span class="n">gramos_kl</span><span class="p">,</span> <span class="n">gramos_lb</span><span class="p">,</span> <span class="n">militros</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
        <span class="n">j_kilos</span> <span class="p">,</span> <span class="n">j_libras</span><span class="p">,</span> <span class="n">j_litros</span> <span class="o">=</span> <span class="p">[],[],[]</span>
        <span class="n">va</span><span class="p">,</span> <span class="n">und_min</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">,</span> <span class="p">[]</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">insumo_id</span><span class="p">,</span> <span class="n">cantidad</span><span class="p">,</span> <span class="n">precio</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ID del insumo es: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot; Los precios son: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
            <span class="n">price</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">valor</span> <span class="o">=</span> <span class="n">Insumos</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id_ins</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ins</span> <span class="ow">in</span> <span class="n">valor</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">nombre_ins</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">unidad_medida_comercial_ins</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ins</span><span class="o">.</span><span class="n">unidad_medida_comercial_ins</span> <span class="o">==</span> <span class="s1">&#39;kilos&#39;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cantidad es: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">cantidad_comercial_ins</span><span class="p">))</span>
                    <span class="n">gramos_kl</span> <span class="o">=</span>  <span class="n">price</span> <span class="o">/</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">cantidad_comercial_ins</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
                    <span class="n">j_kilos</span> <span class="o">+=</span> <span class="p">[</span><span class="n">gramos_kl</span><span class="p">]</span>
                    <span class="n">va</span> <span class="o">+=</span> <span class="p">[</span><span class="n">gramos_kl</span><span class="p">]</span>
                    <span class="n">und_min</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;kl =&gt; gr&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">ins</span><span class="o">.</span><span class="n">unidad_medida_comercial_ins</span> <span class="o">==</span> <span class="s1">&#39;libras&#39;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cantidad es: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">cantidad_comercial_ins</span><span class="p">))</span>
                    <span class="n">gramos_lb</span> <span class="o">=</span> <span class="n">price</span> <span class="o">/</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">cantidad_comercial_ins</span><span class="p">)</span> <span class="o">*</span> <span class="mi">500</span><span class="p">)</span>
                    <span class="n">j_libras</span> <span class="o">+=</span>  <span class="p">[</span><span class="n">gramos_lb</span><span class="p">]</span>
                    <span class="n">va</span> <span class="o">+=</span>  <span class="p">[</span><span class="n">gramos_lb</span><span class="p">]</span>
                    <span class="n">und_min</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;lb =&gt; gr&#39;</span><span class="p">]</span>
                    <span class="c1">#print(&quot;Valor de libras por gramo &quot; + str(gramos_lb))</span>
                <span class="k">elif</span> <span class="n">ins</span><span class="o">.</span><span class="n">unidad_medida_comercial_ins</span> <span class="o">==</span> <span class="s1">&#39;litros&#39;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cantidad litro: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">cantidad_comercial_ins</span><span class="p">))</span>
                    <span class="n">militros</span> <span class="o">=</span>  <span class="n">price</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">cantidad_comercial_ins</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">)</span>
                    <span class="n">j_litros</span>  <span class="o">+=</span> <span class="p">[</span><span class="n">militros</span><span class="p">]</span>
                    <span class="n">va</span> <span class="o">+=</span> <span class="p">[</span><span class="n">militros</span><span class="p">]</span>
                    <span class="n">und_min</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;lt =&gt; ml&#39;</span><span class="p">]</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Militros &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">militros</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">gramos_kl</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span>  <span class="ow">and</span> <span class="n">gramos_lb</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">militros</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">j_kilos</span>
        <span class="k">elif</span> <span class="n">gramos_lb</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">gramos_kl</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">militros</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">j_libras</span>
        <span class="k">elif</span> <span class="n">militros</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">gramos_kl</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">gramos_lb</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">j_litros</span>
        <span class="k">elif</span> <span class="n">gramos_kl</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">gramos_lb</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">militros</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">va</span>
        <span class="k">for</span> <span class="n">insu</span><span class="p">,</span> <span class="n">canti</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">pumi</span><span class="p">,</span> <span class="n">und_min_x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">insumo_id</span><span class="p">,</span> <span class="n">cantidad</span><span class="p">,</span> <span class="n">precio</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">und_min</span><span class="p">):</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">Insumos_Compras</span><span class="p">(</span><span class="n">cantidad</span> <span class="o">=</span> <span class="n">canti</span><span class="p">,</span> <span class="n">precio</span> <span class="o">=</span> <span class="n">prec</span><span class="p">,</span> <span class="n">compra_id</span> <span class="o">=</span> <span class="n">id_compra</span><span class="p">,</span> <span class="n">precio_und_min_ico</span> <span class="o">=</span> <span class="n">pumi</span><span class="p">,</span> <span class="n">und_min_ico</span> <span class="o">=</span> <span class="n">und_min_x</span><span class="p">,</span>       <span class="n">insumo_id</span> <span class="o">=</span>  <span class="n">insu</span><span class="p">)</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;edi&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_REFERER&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;compras:listar&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">insumos</span> <span class="o">=</span> <span class="n">Insumos</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
        <span class="n">propietario</span> <span class="o">=</span> <span class="n">Propietarios</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">raw</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM propietarios WHERE user_id = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">user_id</span><span class="p">])</span>
        <span class="n">fabricas</span> <span class="o">=</span> <span class="n">Fabricas</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">raw</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM fabricas fab INNER JOIN propietarios prop ON fab.propietario_id = prop.id_pro INNER JOIN       auth_user u ON prop.user_id = u.id WHERE u.id = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">user_id</span><span class="p">])</span>
        <span class="n">date_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">date_time</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">date_time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span> <span class="p">(</span><span class="n">date</span><span class="p">)</span>
        <span class="c1">#print (time.hour,time.minute,time.second)</span>
        <span class="n">tiempo</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%S</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">my_time</span> <span class="o">=</span> <span class="p">[</span><span class="n">date</span><span class="p">,</span> <span class="n">tiempo</span><span class="p">]</span>
        <span class="nb">print</span> <span class="p">(</span><span class="n">my_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;compras/crear.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;insumos&#39;</span><span class="p">:</span> <span class="n">insumos</span><span class="p">,</span> <span class="s1">&#39;fabricas&#39;</span><span class="p">:</span><span class="n">fabricas</span><span class="p">,</span> <span class="s1">&#39;propietario&#39;</span><span class="p">:</span><span class="n">propietario</span><span class="p">,</span> <span class="s1">&#39;tiempo&#39;</span><span class="p">:</span><span class="n">tiempo</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="admonition-editar-empleados admonition">
<p class="admonition-title">Editar Empleados</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">EditarCompra</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_compra</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">id_compra</span>  <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id_compra&#39;</span><span class="p">)</span>
        <span class="n">insumo_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;insumo_id[]&#39;</span><span class="p">)</span>
        <span class="n">cantidad</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;cantidad[]&#39;</span><span class="p">)</span>
        <span class="n">precio</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;precio[]&#39;</span><span class="p">)</span>
        <span class="n">id_ico</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;id_ico[]&#39;</span><span class="p">)</span> <span class="c1">#id de la compra del insumo</span>
        <span class="n">val_und_min_ins</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;val_und_min_ins[]&#39;</span><span class="p">)</span>

        <span class="n">total_und</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">unds_arr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">val_und</span><span class="p">,</span> <span class="n">pric</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">val_und_min_ins</span><span class="p">,</span> <span class="n">precio</span><span class="p">):</span>
            <span class="n">val_un</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val_und</span><span class="p">)</span>
            <span class="n">pri</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pric</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;los valores &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val_un</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; los precios &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pri</span><span class="p">))</span>
            <span class="n">total_und</span> <span class="o">=</span>  <span class="n">pri</span> <span class="o">/</span> <span class="n">val_un</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">total_und</span><span class="p">)</span>
            <span class="n">unds_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_und</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">unds_arr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cant</span><span class="p">,</span> <span class="n">precio</span><span class="p">,</span> <span class="n">t_un</span><span class="p">,</span> <span class="n">insumo</span><span class="p">,</span> <span class="n">id_ic</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cantidad</span><span class="p">,</span> <span class="n">precio</span><span class="p">,</span><span class="n">unds_arr</span><span class="p">,</span>  <span class="n">insumo_id</span><span class="p">,</span> <span class="n">id_ico</span><span class="p">):</span>
            <span class="n">Insumos_Compras</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id_ico</span><span class="o">=</span><span class="n">id_ic</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cantidad</span><span class="o">=</span> <span class="n">cant</span><span class="p">,</span> <span class="n">precio</span> <span class="o">=</span> <span class="n">precio</span><span class="p">,</span>  <span class="n">precio_und_min_ico</span> <span class="o">=</span> <span class="n">t_un</span><span class="p">,</span> <span class="n">insumo_id</span> <span class="o">=</span> <span class="n">insumo</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_REFERER&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">compra</span> <span class="o">=</span> <span class="n">Compras</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">raw</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM compras c INNER JOIN propietarios p ON p.id_pro = c.propietario_id INNER JOIN fabricas f ON       c.fabrica_id = f.id_fab   WHERE c.id_compra = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">id_compra</span><span class="p">])</span>
        <span class="n">detalles_compra</span> <span class="o">=</span> <span class="n">Compras</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">raw</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM compras c INNER JOIN propietarios p ON p.id_pro = c.propietario_id INNER JOIN fabricas f       ON c.fabrica_id = f.id_fab INNER JOIN insumos_compras ci ON c.id_compra = ci.compra_id INNER JOIN insumos ins ON ci.insumo_id = ins.id_ins       WHERE c.id_compra = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">id_compra</span><span class="p">])</span>
        <span class="n">insumos_all</span> <span class="o">=</span> <span class="n">Insumos</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;compras/detalles.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;compra&#39;</span><span class="p">:</span><span class="n">compra</span><span class="p">,</span> <span class="s1">&#39;detalles_compra&#39;</span><span class="p">:</span><span class="n">detalles_compra</span><span class="p">,</span> <span class="s1">&#39;insumos_all&#39;</span><span class="p">:</span><span class="n">insumos_all</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="admonition-detalles-compra admonition">
<p class="admonition-title">Detalles Compra</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">DetallesCompra</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

    <span class="n">first_name</span> <span class="o">=</span> <span class="s2">&quot;SENA VELEZ&quot;</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="s2">&quot;SEN&quot;</span>
    <span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;prueba&quot;</span>
    <span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;prueba&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
    <span class="c1">#return render(request, &#39;register.html&#39;)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
        <span class="n">compra_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compra_id&quot;</span><span class="p">)</span>
        <span class="c1">#lista = serializers.serialize(&#39;json&#39;, rooms)</span>
        <span class="n">rooms</span> <span class="o">=</span>   <span class="nb">list</span><span class="p">(</span><span class="n">Insumos_Compras</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">data</span> <span class="o">=</span>  <span class="nb">dict</span><span class="p">()</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rooms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rooms</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;something no GET cause its post&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition-eliminar-compra admonition">
<p class="admonition-title">Eliminar Compra</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">EliminarCompra</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_compra</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Eliminar compra&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition-eliminar-detalle-de-la-compra admonition">
<p class="admonition-title">Eliminar Detalle de la Compra</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">EliminarDetallesCompra</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_ico</span><span class="p">,</span> <span class="n">compra</span><span class="p">):</span>
    <span class="n">insumos_compras</span> <span class="o">=</span> <span class="n">Insumos_Compras</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">id_ico</span> <span class="o">=</span> <span class="n">id_ico</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">insumos_compras</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;compras:editar&#39;</span><span class="p">,</span> <span class="n">compra</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;compras/eliminar.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;insumos_compras&#39;</span><span class="p">:</span> <span class="n">insumos_compras</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="figure align-left">
<img alt="../_images/py.png" src="../_images/py.png" />
</div>
</div>
<div class="section" id="urls">
<h2>Urls<a class="headerlink" href="#urls" title="Permalink to this headline">¶</a></h2>
<p><em>Archivo</em> : <code class="docutils literal notranslate"><span class="pre">urls.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">re_path</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">GetCompras</span><span class="p">,</span> <span class="n">CrearCompra</span><span class="p">,</span> <span class="n">ComprasHome</span><span class="p">,</span> <span class="n">EditarCompra</span><span class="p">,</span> <span class="n">EliminarCompra</span><span class="p">,</span> <span class="n">DetallesCompra</span><span class="p">,</span><span class="n">GetInsID</span><span class="p">,</span> <span class="n">EliminarDetallesCompra</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;get/&#39;</span><span class="p">,</span><span class="n">GetCompras</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;get&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;traer/&#39;</span><span class="p">,</span><span class="n">DetallesCompra</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;traer&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;listar/&#39;</span><span class="p">,</span> <span class="n">login_required</span> <span class="p">(</span><span class="n">ComprasHome</span><span class="p">),</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;listar&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;crear/&#39;</span><span class="p">,</span><span class="n">CrearCompra</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;crear&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;get_ins_id/&#39;</span><span class="p">,</span><span class="n">GetInsID</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;get_ins_id&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;editar/&lt;int:id_compra&gt;&#39;</span><span class="p">,</span><span class="n">EditarCompra</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;editar&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;eliminar/&lt;int:id_compra&gt;&#39;</span><span class="p">,</span><span class="n">EliminarCompra</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;eliminar&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;del/&lt;int:id_ico&gt;/&lt;int:compra&gt;/&#39;</span><span class="p">,</span><span class="n">EliminarDetallesCompra</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;eliminar_detalles&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Y añadiremos esta ruta al aquivo <code class="docutils literal notranslate"><span class="pre">urls.py</span></code> del directorio <code class="xref py py-mod docutils literal notranslate"><span class="pre">costosbocadillo</span></code>:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>

<span class="n">path</span><span class="p">(</span><span class="s1">&#39;compras/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">((</span><span class="s1">&#39;apps.compras.urls&#39;</span><span class="p">,</span> <span class="s1">&#39;compras&#39;</span><span class="p">))),</span>

<span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
<div class="figure align-left">
<img alt="../_images/py.png" src="../_images/py.png" />
</div>
</div>
<div class="section" id="apps">
<h2>Apps<a class="headerlink" href="#apps" title="Permalink to this headline">¶</a></h2>
<p><em>Archivo</em> : <code class="docutils literal notranslate"><span class="pre">apps.py</span></code></p>
<p>Este archivo se crea para ayudar al usuario a incluir cualquier <a class="reference external" href="https://docs.djangoproject.com/en/dev/ref/applications/#application-configuration">configuración de aplicación</a> para la aplicación. Con esto, puede configurar algunos de los atributos de la aplicación:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.apps</span> <span class="kn">import</span> <span class="n">AppConfig</span>

<span class="k">class</span> <span class="nc">ComprasConfig</span><span class="p">(</span><span class="n">AppConfig</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;compras&#39;</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="conversionunid.html" class="btn btn-neutral float-right" title="conversion_unidades" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="centrocostos.html" class="btn btn-neutral" title="CentroCostos" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Esneyder.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>